"use strict";(self.webpackChunkinstana_techxchange=self.webpackChunkinstana_techxchange||[]).push([[3501],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),u=i,h=m["".concat(s,".").concat(u)]||m[u]||d[u]||o;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},19334:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const o={title:"2. OpenTelemetry instrumentation",description:"Instrument demo application with OpenTelemetry",sidebar_position:5},r="OpenTelemetry instrumentation",l={unversionedId:"instana-v2/opentelemetry/opentelemetry-instrumentation/index",id:"instana-v2/opentelemetry/opentelemetry-instrumentation/index",title:"2. OpenTelemetry instrumentation",description:"Instrument demo application with OpenTelemetry",source:"@site/labs/instana-v2/opentelemetry/4-opentelemetry-instrumentation/index.mdx",sourceDirName:"instana-v2/opentelemetry/4-opentelemetry-instrumentation",slug:"/instana-v2/opentelemetry/opentelemetry-instrumentation/",permalink:"/instana-techxchange/labs/instana-v2/opentelemetry/opentelemetry-instrumentation/",draft:!1,editUrl:"https://github.com/IBM/instana-techxchange/tree/main/labs/instana-v2/opentelemetry/4-opentelemetry-instrumentation/index.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"2. OpenTelemetry instrumentation",description:"Instrument demo application with OpenTelemetry",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"1. Instana agent installation",permalink:"/instana-techxchange/labs/instana-v2/opentelemetry/agent-installation/"},next:{title:"3. Web-application monitoring",permalink:"/instana-techxchange/labs/instana-v2/opentelemetry/webapplication-monitoring/"}},s={},p=[{value:"Enable OpenTelemetry in Instana",id:"enable-opentelemetry-in-instana",level:2},{value:"Restart cluster workload",id:"restart-cluster-workload",level:2},{value:"Verify OpenTelemetry Demo Application",id:"verify-opentelemetry-demo-application",level:2},{value:"Create an Application in Instana",id:"create-an-application-in-instana",level:2},{value:"Generate OpenTelemetry Demo Application traffic",id:"generate-opentelemetry-demo-application-traffic",level:2}],c={toc:p},m="wrapper";function d(e){let{components:t,...o}=e;return(0,i.kt)(m,(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"opentelemetry-instrumentation"},"OpenTelemetry instrumentation"),(0,i.kt)("p",null,"For the purpose of this lab, we will use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/instana/opentelemetry-demo/tree/main"},"Instana OpenTelemetry Demo Application"),"\nwhich is the fork of generic ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-demo"},"OpenTelemetry Demo Application"),"."),(0,i.kt)("p",null,"Instana's custom fork of the OpenTelemetry Demo Application is a microservice-based application, integrated with an Instana backend.\nThe demo shows the native Instana OpenTelemetry data collection, correlation of OpenTelemetry tracing and the underlying monitored infrastructure,\nand an example of trace continuity between Instana tracing and OpenTelemetry."),(0,i.kt)("p",null,"OpenTelemetry Demo Application was already installed for you in the lab environment. The following steps are required to enable OpenTelemetry\nin the Instana agent."),(0,i.kt)("p",null,"OpenTelemetry is an open-source observability framework with a collection of software development kits (SDKs), vendor-neutral or vendor-agnostic APIs, and tools for instrumentation.\nThis technology can generate, collect, export, and instrument telemetry data to analyze your platform's behavior and performance. Opentelemetry is also known as OTel.\nOpenTelemetry is included into Instana license, there's no additional payment required, but the monitored servers need to be licensed."),(0,i.kt)("h2",{id:"enable-opentelemetry-in-instana"},"Enable OpenTelemetry in Instana"),(0,i.kt)("p",null,"Let's edit the configmap of instana-agent. We need to enable the OpenTelemetry settings within the instana-agent. They are not enabled by default.  "),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"It is also possible to enable the Agent OpenTelemetry settings during the Helm Install by providing optional configuration parameters that can be found here: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/instana/helm-charts/tree/main/instana-agent"},"https://github.com/instana/helm-charts/tree/main/instana-agent"))),(0,i.kt)("p",null,"Before editing the configmap, let's copy the content that needs to be added into your buffer."),(0,i.kt)("p",null,"Login to you Kubernetes cluster "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"ssh root@10.100.1.60\n")),(0,i.kt)("p",null,'In the terminal window, ensure your in the right directory (/root) and type "ls instana*".  You will see a file named "instana-config-map.txt" as seen below. The file is located in the /root folder'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"cd /root\nls instana*\ninstana-config-map.txt\n")),(0,i.kt)("p",null,"Next, cat the file to view the content that needs to be added to the configmap."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"cat instana-config-map.txt\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"configmap",src:n(32153).Z,width:"1023",height:"611"})),(0,i.kt)("p",null,'Highlight all of the text and then right-click and select "Copy" as shown below.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"configmap",src:n(98518).Z,width:"1016",height:"578"})),(0,i.kt)("p",null,"Next, edit the configmap by typing the command shown below. Do NOT copy/paste this command or you will lose the configmap content from your clipboard."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl edit configmap instana-agent --namespace instana-agent \n")),(0,i.kt)("p",null,"Within the configmap, move your mouse directly below the configuration.yaml line as seen below."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"configmap",src:n(72744).Z,width:"833",height:"205"})),(0,i.kt)("p",null,'Then, type the letter "i" to change to "insert" mode.'),(0,i.kt)("p",null,'Finally, right-click and select "Paste" to paste the additional text into the configmap.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"configmap",src:n(86467).Z,width:"536",height:"346"})),(0,i.kt)("p",null,"The final structure of the configmap should look like the below example"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"configmap",src:n(91867).Z,width:"959",height:"437"})),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Please make sure the indentations are exactly as shown above. YAML file format is very sensitive when it comes to the white characters. Your input should look exactly like above.")),(0,i.kt)("p",null,'Save the file by typing ":wq" '),(0,i.kt)("h2",{id:"restart-cluster-workload"},"Restart cluster workload"),(0,i.kt)("p",null,"Restart all of the instana agents pods to ensure that configmap change was implemented."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl rollout restart daemonset instana-agent --namespace instana-agent \n")),(0,i.kt)("p",null,"Restart will prompt with a message"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"daemonset.apps/instana-agent restarted\n")),(0,i.kt)("p",null,"Restart all of the Otel Demo app pods to ensure the Instana injection was done."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n otel-demo rollout restart deploy \n")),(0,i.kt)("p",null,"Restart will prompt with a message"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"deployment.apps/my-otel-demo-accountingservice restarted\ndeployment.apps/my-otel-demo-adservice restarted\ndeployment.apps/my-otel-demo-cartservice restarted\ndeployment.apps/my-otel-demo-checkoutservice restarted\ndeployment.apps/my-otel-demo-currencyservice restarted\ndeployment.apps/my-otel-demo-emailservice restarted\ndeployment.apps/my-otel-demo-featureflagservice restarted\ndeployment.apps/my-otel-demo-ffspostgres restarted\ndeployment.apps/my-otel-demo-frauddetectionservice restarted\ndeployment.apps/my-otel-demo-frontend restarted\ndeployment.apps/my-otel-demo-frontendproxy restarted\ndeployment.apps/my-otel-demo-kafka restarted\ndeployment.apps/my-otel-demo-loadgenerator restarted\ndeployment.apps/my-otel-demo-paymentservice restarted\ndeployment.apps/my-otel-demo-productcatalogservice restarted\ndeployment.apps/my-otel-demo-quoteservice restarted\ndeployment.apps/my-otel-demo-recommendationservice restarted\ndeployment.apps/my-otel-demo-redis restarted\ndeployment.apps/my-otel-demo-shippingservice restarted\n")),(0,i.kt)("h2",{id:"verify-opentelemetry-demo-application"},"Verify OpenTelemetry Demo Application"),(0,i.kt)("p",null,"Once the instana-agent and OpenTelemetry Demo Application were restarted, it is now time to verify\nif the applications works and delivers metrics as expected."),(0,i.kt)("p",null,"Your instance of OpenTelemetry Demo Application is available under the ",(0,i.kt)("a",{parentName:"p",href:"https://otel-demo.ocp.ibm.edu/"},"https://otel-demo.ocp.ibm.edu/"),"\nLet's use a browser to open that page. Please note the https in the address bar.\nAlso, do not worry about the security message - accept the self-signed certificate."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"otelapp",src:n(81957).Z,width:"1907",height:"936"})),(0,i.kt)("p",null,"Exercise the application to ensure it is working properly."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The OpenTelemetry Demo Application has an automated load running that will generate monitored transactions within Instana.")),(0,i.kt)("h2",{id:"create-an-application-in-instana"},"Create an Application in Instana"),(0,i.kt)("p",null,'Within Instana, it is possible to view the OpenTelemetry Demo Application transactions via the "Analytics" tab or via the "All Services" view within "Applications",\nbut normally, you want to have a view that is specifically tailored to your business application.'),(0,i.kt)("p",null,"To create that customized view of the OpenTelemetry Demo Application, let's create an application perspective in Instana. Log in to your Instana instance and create new application perspective."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"appperspective",src:n(94069).Z,width:"1189",height:"728"})),(0,i.kt)("p",null,'Switch to "Advanced mode"'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"appperspective2",src:n(36984).Z,width:"1043",height:"632"})),(0,i.kt)("p",null,"As seen in the screen capture below: "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"First, provide application name of your choice"),(0,i.kt)("li",{parentName:"ul"},'2nd, select the "Add filter" button.'),(0,i.kt)("li",{parentName:"ul"},'3rd, in the dialog, type the word "cluster" to filter the list.'),(0,i.kt)("li",{parentName:"ul"},'4th, select "Kubernetes -> Cluster Name" from the filtered list.')),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"appperspective2",src:n(94300).Z,width:"645",height:"765"})),(0,i.kt)("p",null,'Continue defining the "Application Perspectiv" as seen in the dialog below.'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'After selecting "Kubernetes -> Cluster Name", you will see a text box.   If you click on the box, it should provide a list of clusters.  You can either select your cluster name or you can type the name of the cluster.'),(0,i.kt)("li",{parentName:"ul"},'Next, select the "All downstream services" radio button.'),(0,i.kt)("li",{parentName:"ul"},'Select the "All Calls" radio button.'),(0,i.kt)("li",{parentName:"ul"},'Finally, click the "Create" button to create the application perspective.')),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"apperspective2",src:n(39028).Z,width:"775",height:"599"})),(0,i.kt)("p",null,'The Instana UI will automatically switch your context to the new "Application Perspetive".  Initially, there will not be any data in the new "Application Perspetive".',(0,i.kt)("br",{parentName:"p"}),"\n","Data will begin to be populated within a couple of minutes."),(0,i.kt)("h2",{id:"generate-opentelemetry-demo-application-traffic"},"Generate OpenTelemetry Demo Application traffic"),(0,i.kt)("p",null,'Now that the "Application Perspective" has been defined and the demo application is back up and running, you can either generate traffic via the UI or allow the automated load to execute.\nTo manually generate traffic, go back to the OpenTelemetry Demo Application in the browser, click through the site and explore the page,\nadd products to the cart, make some orders.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"appperspective2",src:n(12010).Z,width:"1902",height:"922"})),(0,i.kt)("p",null,"Once you have purchased some of the products, let's go back to the Instana UI, open your Application Perspective to see\nthe captured traffic."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"appperspective3",src:n(78106).Z,width:"2455",height:"1126"})),(0,i.kt)("p",null,"This view concludes this chapter. You are now able to see the traffic from your instance of the OpenTelemetry Demo Application captured by Instana.\nLet's move to the next sections."))}d.isMDXComponent=!0},91867:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cmResults-dc51702072d963a1c6f3f2474777a03b.png"},32153:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/configMap-2e68f66017c04e55d3024ba0a2b4b439.png"},39028:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/createApplication2-f505e42d0460c00ed344ed9a6e26b1ba.png"},94300:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/defineApplication-c1887f9e316167c675b43f911cb53840.png"},72744:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/mouseLocation-e9a8af80bbfa6d874e77e3d4cbbeeea3.png"},94069:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/otel-instrumentation-002-fixed-95b93c68eab9d1cca862727639ad5f96.png"},36984:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/otel-instrumentation-003-fixed-fbffaddaa4aa24f80a1c05c348014e54.png"},78106:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/otel-instrumentation-006-fixed-19c28cc62195abc99479e6fb25d20ab8.png"},81957:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/otel-instrumentation-008-b7848518eb846b1eb4d3959ac0f2015b.png"},12010:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/otel-instrumentation-009-2e7bad3cb5b23ba5a112cdf58d45e1dc.png"},86467:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/paste-f2b0f1f5650af0675a344635f8c081be.png"},98518:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/selectText-fa001941970d7ac9c548f302e07cac75.png"}}]);