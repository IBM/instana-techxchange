"use strict";(self.webpackChunkinstana_techxchange=self.webpackChunkinstana_techxchange||[]).push([[5179],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),h=c(n),d=o,m=h["".concat(l,".").concat(d)]||h[d]||u[d]||s;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,i=new Array(s);i[0]=d;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[h]="string"==typeof e?e:o,i[1]=r;for(var c=2;c<s;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},58845:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const s={title:"3. Point of Presence",description:"Welcome to the Synthetic Monitoring and Action Catalog lab",sidebar_position:30},i="Point of Presence",r={unversionedId:"instana-v2/synthetic-pop/pop-installation/index",id:"instana-v2/synthetic-pop/pop-installation/index",title:"3. Point of Presence",description:"Welcome to the Synthetic Monitoring and Action Catalog lab",source:"@site/labs/instana-v2/synthetic-pop/3-pop-installation/index.mdx",sourceDirName:"instana-v2/synthetic-pop/3-pop-installation",slug:"/instana-v2/synthetic-pop/pop-installation/",permalink:"/instana-techxchange/labs/instana-v2/synthetic-pop/pop-installation/",draft:!1,editUrl:"https://github.com/IBM/instana-techxchange/tree/main/labs/instana-v2/synthetic-pop/3-pop-installation/index.mdx",tags:[],version:"current",sidebarPosition:30,frontMatter:{title:"3. Point of Presence",description:"Welcome to the Synthetic Monitoring and Action Catalog lab",sidebar_position:30},sidebar:"tutorialSidebar",previous:{title:"2. Lab Environment",permalink:"/instana-techxchange/labs/instana-v2/synthetic-pop/lab-environment/"},next:{title:"4. REST API",permalink:"/instana-techxchange/labs/instana-v2/synthetic-pop/rest-api/"}},l={},c=[{value:"Install Synthetic Point of Presence component",id:"install-synthetic-point-of-presence-component",level:2}],p={toc:c},h="wrapper";function u(e){let{components:t,...s}=e;return(0,o.kt)(h,(0,a.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"point-of-presence"},"Point of Presence"),(0,o.kt)("h2",{id:"install-synthetic-point-of-presence-component"},"Install Synthetic Point of Presence component"),(0,o.kt)("p",null,"We will be installing the Synthetic Point of Presence into the ",(0,o.kt)("strong",{parentName:"p"},"K8 Control")," Kubernetes cluster. In order to do that, we'll need access to a CLI will access to the cluster."),(0,o.kt)("p",null,"From the browser, open ",(0,o.kt)("strong",{parentName:"p"},"Student VM")," console"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(62886).Z,width:"293",height:"430"})),(0,o.kt)("p",null,"Open a terminal in the Student VM"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(90906).Z,width:"305",height:"549"})),(0,o.kt)("p",null,"Login to the ",(0,o.kt)("strong",{parentName:"p"},"K8 Control")," Kubernetes VM using ssh command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ssh root@10.0.0.20\n")),(0,o.kt)("p",null,'At this point, the Instana server is capable of running and displaying synthetic tests, but you still need to setup the "Synthetic Point of Presence" component.'),(0,o.kt)("p",null,"If Helm wasn't installed during previous labs, install it on bastion node now with command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n")),(0,o.kt)("p",null,"In the Student VM, open the Instana UI in the browser"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(67967).Z,width:"1363",height:"631"})),(0,o.kt)("p",null,'Click on "Synthetic Monitoring" and then on "Deploy a PoP" button:'),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(367).Z,width:"2002",height:"653"})),(0,o.kt)("p",null,"Use ",(0,o.kt)("strong",{parentName:"p"},"Simple")," tab for Helm command. "),(0,o.kt)("p",null,"You will need to edit the information contained in the helm command, so copy and paste the text into a temporary file where you can use an editor such as ",(0,o.kt)("strong",{parentName:"p"},"vi")," to edit the content."),(0,o.kt)("p",null,'The default helm command will look as follows. Some of the parameters have been replace with "xxx" for security reasons.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'helm install synthetic-pop \\\n    --repo "https://agents.instana.io/helm" \\\n    --namespace <namespace> \\\n    --create-namespace \\\n    --set downloadKey="<xxx>" \\\n    --set controller.location="<yourLocationName>;<yourLocationDisplayName>;<yourLocationCountry>;<yourLocationCity>;0;0;<yourLocationDescription>" \\\n    --set controller.clusterName="<yourClusterName>" \\\n    --set controller.instanaKey="4I720vhbzfjAnNS4cuKnNl" \\\n    --set controller.instanaSyntheticEndpoint="https://xxx" \\\n    --set redis.tls.enabled=false \\\n    --set redis.password="<yourPassword>" \\\n    synthetic-pop\n')),(0,o.kt)("p",null,"For Synthetic Point of Presence we need to modify some of the parameters and provide one additional parameter.  "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Modify the ",(0,o.kt)("strong",{parentName:"li"},"controller.clusterName")," parameter and provide a meaningful name."),(0,o.kt)("li",{parentName:"ul"},"In the ",(0,o.kt)("strong",{parentName:"li"},"controller.location"),', specify a name, display name, country, etc. for your "Point of Presence".   The "0;0" parameter represents the longituded and latitude of the "Point of Presence".  These parameters help identify the Point of Presence when  there multiples deployed.'),(0,o.kt)("li",{parentName:"ul"},"In the \t",(0,o.kt)("strong",{parentName:"li"},"controller.instanaKey"),', please specify exactly this value "4I720vhbzfjAnNS4cuKnNl". This is related to the known issue with Instana backend version we are using for this lab. In the real-life scenario, the proper download and Instana key will be populated on the Instana UI.'),(0,o.kt)("li",{parentName:"ul"},"Finally, enter a redis password.  This can be any value since you are setting the password.")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"--set seccompDefault=true")," This parameter is required for OpenShift versions 4.11 and above. This step is not required for our labs as we are using K8S environment"))),(0,o.kt)("p",null,"The helm chart should now look similar the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'helm install synthetic-pop \\\n     --repo https://agents.instana.io/helm  \\\n     --namespace instana-synthetic \\\n     --create-namespace \\\n     --set downloadKey="<xxx>" \\\n     --set controller.location="Local;on Instana cluster;Serbia;Belgrade;39.54;116.23;A test Synthetic Point of Presence" \\\n     --set controller.instanaKey="xxx" \\\n     --set controller.clusterName="MyInstanaCluster" \\\n     --set controller.instanaSyntheticEndpoint="https://xxx/synthetics" \\\n     --set redis.tls.enabled=false \\\n     --set redis.password="a1fc5d01bcbb" \\\n     synthetic-pop\n')),(0,o.kt)("p",null,"Copy the helm command from the text file and paste it into a terminal window on the Bastion node. This will execute the helm chart."),(0,o.kt)("p",null,"You should see an output similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'[root@rhserv ~]$ helm install synthetic-pop \\\n>     --repo https://agents.instana.io/helm  \\\n>     --namespace instana-synthetic \\\n>     --create-namespace \\\n>     --set downloadKey="xxx" \\\n>     --set controller.location="Local;on Instana cluster;Serbia;Belgrade;39.54;116.23;A test Synthetic Point of Presence" \\\n>     --set controller.instanaKey="4I720vhbzfjAnNS4cuKnNl" \\\n>     --set controller.clusterName="MyInstanaCluster" \\\n>     --set controller.instanaSyntheticEndpoint="https://xxx/synthetics" \\\n>     --set redis.tls.enabled=false \\\n>     --set redis.password="a1fc5d01bcbb" \\\n>     synthetic-pop\nNAME: synthetic-pop\nLAST DEPLOYED: Thu Jul 13 07:49:37 2023\nNAMESPACE: instana-synthetic\nSTATUS: deployed\n')),(0,o.kt)("p",null,"After the Synthetic point of presence is installed verify its appearence in the interface:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(25742).Z,width:"1398",height:"670"})),(0,o.kt)("p",null,"You can also confirm that the Synthetic Point of Presence is running by typing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl get pods --namespace=instana-synthetic\n")),(0,o.kt)("p",null,"Expected results should look similar to the below:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(58094).Z,width:"868",height:"129"})),(0,o.kt)("p",null,"Confirm that the pods are all running."),(0,o.kt)("p",null,"The last step is to adjust the internal hosts configuration of the Instana Synthetic PoP. This has to be done because of later need to run a script which will make a call to the Instana API."),(0,o.kt)("p",null,"Please apply the below command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'kubectl patch deployment synthetic-pop-javascript-playback-engine -n instana-synthetic --patch \'{"spec": {"template": {"spec": {"hostAliases": [{"hostnames": ["student-labs.instana.training"],"ip": "10.0.0.10"}]}}}}\'\n')),(0,o.kt)("p",null,"After a few minutes, the list of pods should look like the below"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(58094).Z,width:"868",height:"129"})))}u.isMDXComponent=!0},367:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/DeployAPoP-new-63014e3dcda96419543563aca376e7be.png"},25742:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/PointOfPresence_Location-new-641ed45accd139d2bf0a32e2c2948ad5.png"},67967:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/instana-ui-new-31bb6b547cd81000a9fc2c7a480167a0.png"},58094:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pop-syn-pods-1f732224c03fb728160dc2b2c3d782dc.png"},90906:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/student-terminal-new-b6efc41966bf06ceb60c1492bfc16cd0.png"},62886:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/student-vm-new-bdae52ea0a7da187f16eb694c4959146.png"}}]);