"use strict";(self.webpackChunkinstana_techxchange=self.webpackChunkinstana_techxchange||[]).push([[8485],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),c=p(n),g=o,m=c["".concat(l,".").concat(g)]||c[g]||h[g]||i;return n?a.createElement(m,s(s({ref:t},u),{},{components:n})):a.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=g;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[c]="string"==typeof e?e:o,s[1]=r;for(var p=2;p<i;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},2679:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const i={title:"4. Agent Installation",description:"How to install, configure and troubleshoot Instana agent",sidebar_position:5},s="Agent Installation",r={unversionedId:"instana-v2/server-and-agent-install-lab/agent-installation/index",id:"instana-v2/server-and-agent-install-lab/agent-installation/index",title:"4. Agent Installation",description:"How to install, configure and troubleshoot Instana agent",source:"@site/labs/instana-v2/server-and-agent-install-lab/4-agent-installation/index.mdx",sourceDirName:"instana-v2/server-and-agent-install-lab/4-agent-installation",slug:"/instana-v2/server-and-agent-install-lab/agent-installation/",permalink:"/instana-techxchange/labs/instana-v2/server-and-agent-install-lab/agent-installation/",draft:!1,editUrl:"https://github.com/IBM/instana-techxchange/tree/main/labs/instana-v2/server-and-agent-install-lab/4-agent-installation/index.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"4. Agent Installation",description:"How to install, configure and troubleshoot Instana agent",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"3. Instana Server Installation (Standard Edition)",permalink:"/instana-techxchange/labs/instana-v2/server-and-agent-install-lab/server-installation/"},next:{title:"Quiz",permalink:"/instana-techxchange/labs/instana-v2/server-and-agent-install-lab/quiz/"}},l={},p=[{value:"4.1: Instana Agent Deployment Options",id:"41-instana-agent-deployment-options",level:2},{value:"4.2: Installing Instana Agent on a Linux VM",id:"42-installing-instana-agent-on-a-linux-vm",level:2},{value:"4.3: Installing Instana Agent on the Kubernetes Cluster",id:"43-installing-instana-agent-on-the-kubernetes-cluster",level:2},{value:"4.5: View Instana Agents in the Instana UI",id:"45-view-instana-agents-in-the-instana-ui",level:2},{value:"4.6: Troubleshooting Instana Agent Installation on Linux",id:"46-troubleshooting-instana-agent-installation-on-linux",level:2},{value:"4.7: Troubleshooting Instana Agent Installation on Kubernetes Cluster",id:"47-troubleshooting-instana-agent-installation-on-kubernetes-cluster",level:2},{value:"4.8: Configuring Proxy",id:"48-configuring-proxy",level:2},{value:"4.9: Configuring Instana Agent",id:"49-configuring-instana-agent",level:2},{value:"4.10: Configuring GitOps for Agents",id:"410-configuring-gitops-for-agents",level:2},{value:"4.11: Configuring GitOps for Agents",id:"411-configuring-gitops-for-agents",level:2}],u={toc:p},c="wrapper";function h(e){let{components:t,...i}=e;return(0,o.kt)(c,(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"agent-installation"},"Agent Installation"),(0,o.kt)("h2",{id:"41-instana-agent-deployment-options"},"4.1: Instana Agent Deployment Options"),(0,o.kt)("p",null,"Instana has a variety of agent installation options including the mirror\nrepository and static agents that allow customers to meet strict change control\nprocesses. Some of the available options are listed below:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"OS specific installer (Linux, MacOS, Windows, UNIX)"),(0,o.kt)("li",{parentName:"ul"},"Container setup"),(0,o.kt)("li",{parentName:"ul"},"Docker (and other container managers)"),(0,o.kt)("li",{parentName:"ul"},"Kubernetes"),(0,o.kt)("li",{parentName:"ul"},"OpenShift"),(0,o.kt)("li",{parentName:"ul"},"Hosted Cloud Services"),(0,o.kt)("li",{parentName:"ul"},"Serverless component")),(0,o.kt)("p",null,"All above mentioned methods are accessible via the wizard on the Instana UI"),(0,o.kt)("admonition",{title:"Important",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The Instana agent install requires ",(0,o.kt)("strong",{parentName:"p"},"root")," privileges in order to gain the full benefits of the monitoring capabilities, including auto-discovery and auto-instrumentation.")),(0,o.kt)("p",null,"When installing Instana agent you have to select if you want the agent to be\n",(0,o.kt)("strong",{parentName:"p"},"dynamic")," or ",(0,o.kt)("strong",{parentName:"p"},"static")," based on whether it can update itself or not. Here is\nthe excerpt from the\n",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/SSE1JP5_current/src/pages/setup_and_manage/host_agent/index.html"},"Instana agent documentation"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"A ",(0,o.kt)("strong",{parentName:"p"},"Dynamic")," host agent downloads on startup the latest set of sensors from\nrepositories. By default, a dynamic agent updates itself daily with the latest\nand greatest capabilities that are released. It is also possible to tightly\ncontrol the updating of dynamic host agents by\n",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=agents-configuring-updates-dynamic-host#version-pinning"},"pinning a version")),(0,o.kt)("p",{parentName:"li"},"By default, dynamic host agents use the Instana repository to pull updates,\nbut it is possible to\n",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=agents-setting-up-agent-repositories-dynamic-host"},"set up your own managed mirror"),".\nCurrently, the mirror must be a Nexus repository. This is probably the best\noption for must customers because it allows them the benefits of automatic\nupdates, while at the same time controlling the content that is in the\nrepository.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"A ",(0,o.kt)("strong",{parentName:"p"},"Static"),' host agent is a self-contained host agent that includes all the\nlatest available components at the time of its release, and has no dynamic\nupdate capabilities. The static host agent has a stable "bill of materials"\nthat never changes after the host agent\'s installation.'))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Static host agents require no internet connection to the Instana repository, and\nare recommended in restrictive network setups or strict change control processes.")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"42-installing-instana-agent-on-a-linux-vm"},"4.2: Installing Instana Agent on a Linux VM"),(0,o.kt)("p",null,"We will start by installing the Instana Agent on the middleware Linux VM that is running\nIBM DB2"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"lab environment",src:n(45510).Z,width:"973",height:"733"})),(0,o.kt)("p",null,"Open a new terminal tab by selecting ",(0,o.kt)("strong",{parentName:"p"},"File")," -> ",(0,o.kt)("strong",{parentName:"p"},"New Tab")," or launch a new terminal window."),(0,o.kt)("p",null,"SSH to the middleware server as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ssh root@middleware\n")),(0,o.kt)("p",null,"When prompted, type ",(0,o.kt)("strong",{parentName:"p"},"Passw0rd")," for the root password."),(0,o.kt)("p",null,"Assuming you haven't clicked on anything, your Firefox browser should be showing the welcome screen.\n",(0,o.kt)("img",{src:n(3910).Z,width:"1601",height:"667"})),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you aren't on the ",(0,o.kt)("strong",{parentName:"p"},"Welcome")," screen or ",(0,o.kt)("strong",{parentName:"p"},"Installing Instana Agents")," screen you can get there by\nselecting the ",(0,o.kt)("strong",{parentName:"p"},'"Home"')," icon in the upper left corner and then clicking\nthe ",(0,o.kt)("strong",{parentName:"p"},'"Deploy Agent"')," button near the upper right corner."),(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("img",{src:n(50390).Z,width:"1789",height:"173"}))),(0,o.kt)("p",null,"On this screen, you will see all of the Installation options that can be used to install the Instana Agent.",(0,o.kt)("br",{parentName:"p"}),"\n","Look at the boxes labeled ",(0,o.kt)("strong",{parentName:"p"},"Linux"),".  You will see a few options including the ",(0,o.kt)("strong",{parentName:"p"},"Automatic Installation (One-liner)"),", ",(0,o.kt)("strong",{parentName:"p"},"Packages (DEB, RPM)"),", and ",(0,o.kt)("strong",{parentName:"p"},"Archive tar.gz"),".\nAll of these options will work. It just depends on your preferences.  However, the easiest and suggested option for is to use the ",(0,o.kt)("strong",{parentName:"p"},"Automatic Installation (one-liner)"),". "),(0,o.kt)("p",null,"This installation option requires access to an Agent and sensor repository.  The repository can be mirrored internally or is available externally.  For this lab, we will use the external repository."),(0,o.kt)("p",null,"Click on the box labeled ",(0,o.kt)("strong",{parentName:"p"},"Automatic Installation (one-liner)"),".  "),(0,o.kt)("p",null,"You will see a configuration panel as seen below.  There are a few key options that are highlighted.  With one exception, you should be able to use the defaults and simply copy/paste the curl command.  "),(0,o.kt)("p",null,"The one option that you do want to change is to select the checkbox to ",(0,o.kt)("strong",{parentName:"p"},"Install and start as a service"),".  This will ensure that the Agent starts automatically when the server reboots."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(28314).Z,width:"1163",height:"483"})),(0,o.kt)("p",null,"You are now ready to begin the install.   Copy the curl command from the Instana user interface and paste it into the terminal window where you are logged into the ",(0,o.kt)("strong",{parentName:"p"},"middleware")," virtual machine."),(0,o.kt)("p",null,"Next, you will be prompted to confirm the install.  Answer ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"y"))," when prompted."),(0,o.kt)("p",null,"Once complete you will see the below:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(34092).Z,width:"1164",height:"226"})),(0,o.kt)("p",null,"At this point the Agent is installed and up and running. You can confirm this by\nrunning:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ps -ef | grep instana\n")),(0,o.kt)("p",null,"You should see a process running, the short version looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"root       22012       1 99 12:35 ?        00:00:11 /opt/instana/agent/jvm/bin/java\n")),(0,o.kt)("p",null,"The Agent will automatically start monitoring the operating system and start\ndiscovering key processes and middleware. In many cases it will automatically\ninstrument those technologies. In the case of some technologies (eg. IBM App Connect Enterprise and DB2), there are manual configuration steps required due to\nthe need to provide credentials for accessing those applications."),(0,o.kt)("p",null,"Let's configure one of those technologies that require configuration.  In this case, the DB2 sensor requires some configuration parameters."),(0,o.kt)("p",null,"From the terminal window on the middleware VM, edit the Instana configuration.yaml file by typing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"vi /opt/instana/agent/etc/instana/configuration.yaml\n")),(0,o.kt)("p",null,"This configuration.yaml file has a number of parameters that can be configured.  For example, you can define a ",(0,o.kt)("strong",{parentName:"p"},"zone")," where the VM will appear in the Infrastructure view."),(0,o.kt)("p",null,"Please remember that yaml files are very sensitive to spacing.  Each line must be indented by 0, 2, 4, 6, spaces, etc. and must be indented with spaces and not tabs."),(0,o.kt)("p",null,"Search for ",(0,o.kt)("strong",{parentName:"p"},"Hardware & Zone")," by typing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/Hardware\n")),(0,o.kt)("p",null,"You will be taken to the ",(0,o.kt)("strong",{parentName:"p"},"Hardware & Zone")," section.  Uncomment the last 3 lines in the section and change the value for the availability-zone to ",(0,o.kt)("strong",{parentName:"p"},"lab"),"."),(0,o.kt)("p",null,"The file should now look like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4797).Z,width:"336",height:"87"})),(0,o.kt)("p",null,"Next, let's edit the configuration for the DB2 sensor.  DB2 requires key configuration information such as the port and credentials in order to monitor the databases."),(0,o.kt)("p",null,"For more information on configuring the DB2 sensor see the ",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=technologies-monitoring-db2#configuring-ibm-db2-sensor"},"DB2 sensor documentation"),"."),(0,o.kt)("p",null,"Within the configuration.yaml file, type the following to search for the DB2 section."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/DB2\n")),(0,o.kt)("p",null,"Within this section, you will see many options including both local and remote monitoring.  We will configure local monitoring.\nUncomment the lines shown in the picture below.  You should uncomment 8 lines in the configuration.yaml file.  Then, change the following values:"),(0,o.kt)("p",null,"Change the ",(0,o.kt)("strong",{parentName:"p"},"port")," value to ",(0,o.kt)("strong",{parentName:"p"},"25010"),"\nChange the ",(0,o.kt)("strong",{parentName:"p"},"password")," value to ",(0,o.kt)("strong",{parentName:"p"},"Passw0rd"),"\nChange the database name from ",(0,o.kt)("strong",{parentName:"p"},"database1")," to ",(0,o.kt)("strong",{parentName:"p"},"TEST")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(72167).Z,width:"793",height:"534"})),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You may notice that we are putting a password into a configuration file.  Since we don't need our passwords to be secure for this lab, we are entering them directly in the file."),(0,o.kt)("p",{parentName:"admonition"},"But, Instana does have an option to store sensitive information in kubernetes secrets, ",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=cha-configuring-host-agents-by-using-agent-configuration-file#ibm-cloud-secrets-manager"},"IBM Cloud Secret Manager")," or in ",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=cha-configuring-host-agents-by-using-agent-configuration-file#hashicorp-vault"},"Hashicorp vault"),".")),(0,o.kt)("p",null,"The configuration yaml file contains many other options including monitoring ",(0,o.kt)("strong",{parentName:"p"},"custom processes"),", ",(0,o.kt)("strong",{parentName:"p"},"filesystems"),", ",(0,o.kt)("strong",{parentName:"p"},"custom java classes")," and much more. "),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Updates to the configuration.yaml file are read dynamically by the Instana Agent.  As soon as you save your changes to the file, the Instana Agent will read the changes use the configuration settings that you made.")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"43-installing-instana-agent-on-the-kubernetes-cluster"},"4.3: Installing Instana Agent on the Kubernetes Cluster"),(0,o.kt)("p",null,"The next step is to install the Instana Agent into the ",(0,o.kt)("strong",{parentName:"p"},"k8control")," Single Node\nkubernetes cluster.  This cluster has ",(0,o.kt)("strong",{parentName:"p"},"Robot Shop")," application installed and running with automated application traffic."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"lab environment",src:n(45510).Z,width:"973",height:"733"})),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Throughout this lab, we will be using the ",(0,o.kt)("strong",{parentName:"p"},"kubectl")," command to run commands within\nthe kubernetes cluster. We will also be using the ",(0,o.kt)("strong",{parentName:"p"},"helm")," command to perform the Agent install.  ")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Open another tab in your terminal")," or open a new ",(0,o.kt)("strong",{parentName:"p"},"terminal")," window. "),(0,o.kt)("p",null,"From the terminal window, ssh to the k8control server by typing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ssh root@k8control\n")),(0,o.kt)("p",null,"If prompted, type ",(0,o.kt)("strong",{parentName:"p"},"Passw0rd")," for the root password."),(0,o.kt)("p",null,"You should now be logged into the virtual machine that is running kubernetes.   "),(0,o.kt)("p",null,"Check to make sure you are in the right place by running the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl get pods -A\n")),(0,o.kt)("p",null,"You should see a list of pods that are running in the cluster, including the robot-shop pods."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"In some kubernetes clusters, permissions are locked down fairly tight and may require additional configuration to enable the Instana Agent to monitor the entire cluster.\nIn the lab environment, no additional configuration is necessary.")),(0,o.kt)("p",null,"From the ",(0,o.kt)("strong",{parentName:"p"},"Installing Instana Agents")," screen we will be selecting an option to Install the Agent in a kubernetes environment."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you aren't on the ",(0,o.kt)("strong",{parentName:"p"},"Installing Instana Agents")," screen you can get there by\nselecting the ",(0,o.kt)("strong",{parentName:"p"},'"Home"')," icon in the upper left corner and then clicking\nthe ",(0,o.kt)("strong",{parentName:"p"},'"Deploy Agent"')," button near the upper right corner."),(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("img",{src:n(50390).Z,width:"1789",height:"173"}))),(0,o.kt)("p",null,"You will see a number of tiles for Installing the Instana Agent into different environments.  For Kubernetes environments, you will see options for"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Kubernetes helm chart"),(0,o.kt)("li",{parentName:"ul"},"Kubernetes Operator"),(0,o.kt)("li",{parentName:"ul"},"Kubernetes yaml"),(0,o.kt)("li",{parentName:"ul"},"And specific options for Kubernetes in AWS and Azure.")),(0,o.kt)("p",null,"Our general recommendation is to use the helm install.  While there are benefits to Operator based installs, it is more complex than the helm install."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(29098).Z,width:"1463",height:"438"})),(0,o.kt)("p",null,"Select the tile for the ",(0,o.kt)("strong",{parentName:"p"},"Kubernetes helm chart")),(0,o.kt)("p",null,"A dialog will open providing details for the helm chart."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(47493).Z,width:"1267",height:"464"})),(0,o.kt)("p",null,"In the dialog, first enter a name for your kubernetes cluster.   We recommend specifying ",(0,o.kt)("strong",{parentName:"p"},"k8control"),".  Then, specify a ",(0,o.kt)("strong",{parentName:"p"},"zone")," name for your cluster.  "),(0,o.kt)("p",null,"As you enter those parameters, the helm command in the black area will be updated to include the cluster name and zone name that you specified."),(0,o.kt)("p",null,"Next, click the ",(0,o.kt)("strong",{parentName:"p"},"copy")," button and the text for the helm command will be copied into your buffer."),(0,o.kt)("p",null,"Then, within the ",(0,o.kt)("strong",{parentName:"p"},"terminal window")," on the ",(0,o.kt)("strong",{parentName:"p"},"k8control")," virtual machine, ",(0,o.kt)("strong",{parentName:"p"},"right click")," and select ",(0,o.kt)("strong",{parentName:"p"},"paste")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(89427).Z,width:"445",height:"325"})),(0,o.kt)("p",null,"You will see the helm command pasted onto your screen. "),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(37519).Z,width:"614",height:"231"})),(0,o.kt)("p",null,"After seeing the text on the screen, press the ",(0,o.kt)("strong",{parentName:"p"},"Enter")," key to submit the helm command."),(0,o.kt)("p",null,"The helm chart will begin installing into the Kubernetes cluster.  It will automatically create the instana-agent namespace and then install the Agent into that namespace."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"When you install the Agent into a Kubernetes environment, it installs two componenets.  First, it installs the ",(0,o.kt)("strong",{parentName:"p"},"Host Agent")," as a daemonset so that one Agent runs as a pod on each worker node.\nThere are optional parameters that allow you to run the daemonset on the ",(0,o.kt)("strong",{parentName:"p"},"Master")," nodes as well.  In addition, a deployment called ",(0,o.kt)("strong",{parentName:"p"},"k8sensor")," is deployed.\nIt will deploy 3 replicas of the pod to ensure resilieincy.  The k8sensor is responsible for monitoring the kubernetes cluster performance and availability.")),(0,o.kt)("p",null,"To confirm that the Agent is installed and running, type:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl get pods -n instana-agent\n")),(0,o.kt)("p",null,"You should see both the ",(0,o.kt)("strong",{parentName:"p"},"instana-agent")," and ",(0,o.kt)("strong",{parentName:"p"},"k8sensor")," pods running."),(0,o.kt)("p",null,"After a few minutes, you will can see both the ",(0,o.kt)("strong",{parentName:"p"},"Host Agent")," and the ",(0,o.kt)("strong",{parentName:"p"},"k8sensor")," in the Instana user interface."),(0,o.kt)("p",null,"This completes the installation of Instana agent on Kubernetes cluster."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"45-view-instana-agents-in-the-instana-ui"},"4.5: View Instana Agents in the Instana UI"),(0,o.kt)("p",null,"From the welcome page, click the ",(0,o.kt)("strong",{parentName:"p"},"Go to Instana!")," button\n",(0,o.kt)("img",{src:n(83790).Z,width:"1599",height:"238"})),(0,o.kt)("p",null,"From the ",(0,o.kt)("strong",{parentName:"p"},"Installing Instana Agents")," screen, select the ",(0,o.kt)("strong",{parentName:"p"},"Go to Instana!"),"\nbutton. If you don't see the button you can move on to the next step."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(46266).Z,width:"2568",height:"2232"})),(0,o.kt)("p",null,"Select ",(0,o.kt)("strong",{parentName:"p"},"Infrastructure")," from the left navigation menu."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(30658).Z,width:"1946",height:"1134"})),(0,o.kt)("p",null,"You should see 3 nodes reporting. The ",(0,o.kt)("strong",{parentName:"p"},"Instana VM"),", the ",(0,o.kt)("strong",{parentName:"p"},"middleware VM")," and the\n",(0,o.kt)("strong",{parentName:"p"},"k8control kubernetes VM"),". If you don't see them yet, give the agents a\nfew minutes to start up."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(78004).Z,width:"675",height:"600"})),(0,o.kt)("p",null,"In addition, if you click on ",(0,o.kt)("strong",{parentName:"p"},"Platformm")," and then ",(0,o.kt)("strong",{parentName:"p"},"Kubernetes"),", you will see that you are monitoring two kubernetes clusters.\nThe first cluster is the self-monitoring for your Instana server (backend) and the other cluster is the k8control kubernetes cluster."),(0,o.kt)("p",null,"You can click on the blue links with the cluster names to drill into the cluster details."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(76227).Z,width:"1669",height:"452"})),(0,o.kt)("h2",{id:"46-troubleshooting-instana-agent-installation-on-linux"},"4.6: Troubleshooting Instana Agent Installation on Linux"),(0,o.kt)("p",null,"If you cannot see the ",(0,o.kt)("strong",{parentName:"p"},"middleware")," hosts in the Instana UI you\nshould read the Instana agent logs on the respective agent host located at\n",(0,o.kt)("inlineCode",{parentName:"p"},"/opt/instana/agent/data/log/agent.log"),". Look for the current status and any\nwarnings or errors that may be shown."),(0,o.kt)("h2",{id:"47-troubleshooting-instana-agent-installation-on-kubernetes-cluster"},"4.7: Troubleshooting Instana Agent Installation on Kubernetes Cluster"),(0,o.kt)("p",null,"If you don't see the ",(0,o.kt)("strong",{parentName:"p"},"Instana")," node or the **k8control node after a couple of\nminutes, you need to troubleshoot the Instana Agent that is running in kubernetes.  "),(0,o.kt)("admonition",{title:"Important",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The following must be done from a terminal window on each of the kubernetes cluster nodes (instana and k8control)")),(0,o.kt)("p",null,"Check to make sure that all pods are running. Since Instana agent runs as a\nDaemonSet the number of pods should be equal to number of nodes in your cluster,\nin this case one."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl get pods -n instana-agent\n")),(0,o.kt)("p",null,"You can check the Instana Agent pod logs by typing the following.  Make sure to replace ",(0,o.kt)("strong",{parentName:"p"},"<pod_name>")," with the actual pod name."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl logs <pod_name> -n instana-agent\n")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"48-configuring-proxy"},"4.8: Configuring Proxy"),(0,o.kt)("admonition",{title:"Information Only",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.kt)("p",null,"If there is no direct connectivity for the Instana agent you may need to setup a\nproxy. There are 2 connections with 2 different locations for configuration:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Connection to ",(0,o.kt)("strong",{parentName:"li"},"Instana Backend")," - defined in\n",(0,o.kt)("em",{parentName:"li"},"INSTANA-AGENT-DIR"),"/etc/instana/com.instana.agent.main.sender.Backend.cfg"),(0,o.kt)("li",{parentName:"ul"},"Connection to ",(0,o.kt)("strong",{parentName:"li"},"Agent/Sensor Repository")," - defined in\n",(0,o.kt)("em",{parentName:"li"},"INSTANA-AGENT-DIR"),"/etc/mvn-settings.xml (This is used in case client wants to\nsetup internal maven2 mirror repository)")),(0,o.kt)("p",null,"Proxy configuration goes into the respective files. You can also use\n",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/obi/current?topic=requirements-installing-host-agent-docker#agent-configuration"},"environment variables")),(0,o.kt)("p",null,"For backend connectivity you have to define ",(0,o.kt)("em",{parentName:"p"},"INSTANA",(0,o.kt)("em",{parentName:"em"},"AGENT_PROXY"))," variables.\nFor repository connectivity you have to define ",(0,o.kt)("em",{parentName:"p"},"INSTANA",(0,o.kt)("em",{parentName:"em"},"REPOSITORY_PROXY")),"\nvariables."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"49-configuring-instana-agent"},"4.9: Configuring Instana Agent"),(0,o.kt)("admonition",{title:"Information Only",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.kt)("p",null,"There are multiple ways to configure the Instana agent. These instructions apply\nto the Instana Agent installed on a traditional server. Instructions would be\ndifferent for docker or kubernetes versions of the Agent. Settings related to\nagent functionality reside in ",(0,o.kt)("inlineCode",{parentName:"p"},"configuration.yaml")," file located by default in\n",(0,o.kt)("inlineCode",{parentName:"p"},"/opt/instana/agent/etc/instana")," directory. However, other settings related to\nagent environment sits in other ","*",".cfg files."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Agent will actually read and use ANY yaml file in that directory.")),(0,o.kt)("p",null,"Some customers choose to have separate yaml files for each key technology. For\nexample, you could create a mq.yaml file and an ace.yaml file in the same\ndirectory and it would read both files. ",(0,o.kt)("inlineCode",{parentName:"p"},"configuration.yaml")," will contain sample\nconfiguration entries and comments for ALL available sensors at the time of your\ninstall, ",(0,o.kt)("strong",{parentName:"p"},"BUT")," it will not automatically add new sensor config as new sensors\nbecome available."),(0,o.kt)("p",null,"For host based installation you can update ",(0,o.kt)("inlineCode",{parentName:"p"},"configuration.yaml")," and agent should\npick up changes automatically (no restart required). For Kubernetes based\ninstallations, there is ",(0,o.kt)("inlineCode",{parentName:"p"},"instana-agent")," configmap where you can customize the\nsame content that you see in the configuration.yaml file. Using kubernetes/oc\ncommands, you can edit the configmap."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Instana agent configuration file must be a proper YAML - if your changes are not\napplied, make sure that it's not a formatting error")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"410-configuring-gitops-for-agents"},"4.10: Configuring GitOps for Agents"),(0,o.kt)("admonition",{title:"Information Only",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.kt)("p",null,"If you don't want to modify the Instana agent configuration files for each agent\nlocally, you can setup a centralized git repository for configuration files and\ninstruct Instana agent to use these files. To accomplish that, follow the steps\nfrom the\n",(0,o.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/obi/current?topic=configuration-git-based-management#git-based-configuration-management"},"documentation"),"."),(0,o.kt)("p",null,"The Instana agent fetches configuration updates from the remote repository:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Upon the startup or restart."),(0,o.kt)("li",{parentName:"ol"},"Through a reboot initiated over the Agent Management Dashboard."),(0,o.kt)("li",{parentName:"ol"},"Through a configuration change over the Agent Management Dashboard."),(0,o.kt)("li",{parentName:"ol"},"Through the Web API as described in the Host Agent section and the\nintegrations that rely on it like the GitHub Update Agent action.")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"411-configuring-gitops-for-agents"},"4.11: Configuring GitOps for Agents"),(0,o.kt)("p",null,"In this section of the lab, you have learned how to install and configure\nAgents on traditional Linux VMs and kubernetes.  This includes the configuration of the ",(0,o.kt)("strong",{parentName:"p"},"Zone")," and the ",(0,o.kt)("strong",{parentName:"p"},"DB2")," sensor.\nFinally, you have viewed the monitoring Agents and sensors within the Instana user interface."))}h.isMDXComponent=!0},34092:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/agentInstall-cb7d1e96aead06e4d706c13fa012fbbe.png"},76227:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/clusters-74d85de49a3f82db3a3b0d5f0630bfbb.png"},72167:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/db2-8565c72b49e9c82a263e2bc29e61a516.png"},46266:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/go-to-instana-58470d1346aca63784c280a67677ad5c.png"},83790:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/goToInstana-246e8698a57499ee684803b4408ecc90.png"},4797:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/hardwareZone-3eacc18c7483caedd7cc7ae0fd744b62.png"},29098:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/helmInstall-7fb55233449bd91342de851b48db8540.png"},47493:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/helmInstall2-ee39addcabb0d026f6140988265c886e.png"},78004:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/infrastructure-61fc2d06ec8997f4f36a8acd3f1e155e.png"},50390:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/installAgents-f67a61c71efb90f3f5543b75c8671224.png"},45510:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/labEnvironment-8450ca73ab9658cd0155917327fdd446.png"},28314:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/one-liner-86ee784df04ee46931ff38fc5d48bd51.png"},89427:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pasteHelm-f339ba82f45504223721cbe22fa7118d.png"},37519:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pasteHelm2-5a18667cdacc4c63eb525abfa9400e3a.png"},30658:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/select-infra-from-home-0f7267ac6d139e75ec9af73a68309eb2.png"},3910:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/welcome-75bd407e3555d7815a637f2b37b2a03a.png"}}]);