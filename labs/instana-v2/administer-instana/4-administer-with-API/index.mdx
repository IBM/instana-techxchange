---
title: 4. Administer Instana with API
description: Perform Administrative Functions with Instana using API's
sidebar_position: 4
---

# Administer Instana with API's


In this section of the lab we will create an API Token that will be used for executing the Instana Rest API calls. The Instana web REST API allows for retrieval of data such as traces and metrics, as well as configuration, such as service extraction and user management.
In order to use the web REST API, you need to create an API token and assign permissions.


From the Bastion host open the Firefox browser and select the **Instana**
bookmark.

:::tip

If you are unsure how to get access to the Bastion host (Guacamole) see
[Accessing a Lab Environment](/instana-techxchange/labs/jam-in-a-box/#accessing-a-lab-environment)
:::


![open firefox](images/open-firefox.png)



:::info

You can safely ignore the warning about the certificate being untrusted.

![untrusted-cert-advance](../3-administer/images/untrusted-cert-advance.png)

:::

When prompted, enter the username and password from teh credentials file.

![](../3-administer/images/login.png)


## 4.1: Create an Instana API Token

1. Logon to the Instana and select the Settings on the left menu

>>>![](images/api_1.png)

2. Select API Tokens menu item in **ACCESS CONTROL** and Select **Add API Token** on the right to add a new toekn

>>>![](images/api_2.png)


3. Enter a name for the token, for example **RestAPILab**

>>>![](images/api_3.png)

4. In the **Permissions** section enable the following permissions

>>> User management\
Configuration of applications\
Service & endpoint mapping\
Configuration of automation actions\
Execution of automation actions\
Configuration of alert channels\
Configuration of Events, Alerts and Smart Alerts\
Configuration of global custom payload for alerts\
Configuration of global Smart Alerts\
Configuration of releases\
Configuration of agents\
Website monitoring configuration\

>>>![](images/api_4.png)

5. Select the **Save** button at the bottom of the page to save the API Token

>>>![](images/api_5.png)

6. Select the token to copy it to the clipboard. The Token will be used in the subsequent section of the lab to execute the API's 
   

>>>![](images/api_6.png)

7. Create a **HOST** and **API_TOKEN** environment variables on the bastion host

    Open the Terminal window on the Bastion host by selecting the Terminal icon on the desktop

    ![](images/open-terminal.png)


    export HOST=dev-aiops.apps.ocp.ibm.edu  <br /> 
    export API_TOKEN=<Token from step #6>


:::tip
To copy and paste from teh lab guide to the bastion host window, use the Insert Text icon at the top of the window.

![](images/copy-and-paste.png)
:::

## 4.2: Application Metrics


The API calls will be done in the same terminal Window. Copy and Paste the request curl command to the Terminal window.

### List all applications

Request:

```json
 curl -k --silent -X GET -H "authorization: apiToken $API_TOKEN"  "https://$HOST/api/application-monitoring/applications?pretty"
```

Response:

```json
{
  "items" : [ {
    "id" : "hov5KXevQMW8cM5wnGqgZw",
    "label" : "Robot-Shop",
    "boundaryScope" : "ALL",
    "entityType" : "APPLICATION",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications;id=hov5KXevQMW8cM5wnGqgZw?to=1692667910745&windowSize=600000",
      "services" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications;id=hov5KXevQMW8cM5wnGqgZw/services?to=1692667910745&windowSize=600000"
    }
  }, {
    "id" : "USD9KEU_SWaBbvj6AxubSA",
    "label" : "qotd",
    "boundaryScope" : "ALL",
    "entityType" : "APPLICATION",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications;id=USD9KEU_SWaBbvj6AxubSA?to=1692667910745&windowSize=600000",
      "services" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications;id=USD9KEU_SWaBbvj6AxubSA/services?to=1692667910745&windowSize=600000"
    }
  }, {
    "id" : "_8O83anZQW-72LB-HtBECg",
    "label" : "All Services",
    "boundaryScope" : "INBOUND",
    "entityType" : "APPLICATION",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications;id=_8O83anZQW-72LB-HtBECg?to=1692667910745&windowSize=600000",
      "services" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications;id=_8O83anZQW-72LB-HtBECg/services?to=1692667910745&windowSize=600000"
    }
  } ],
  "page" : 1,
  "pageSize" : 50,
  "totalHits" : 7,
  "adjustedTimeframe" : {
    "windowSize" : 590000,
    "to" : 1692667910000
  },
  "_links" : {
    "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications?to=1692667910745&windowSize=600000&page=1&pageSize=50"
  }
}
```

### List applications with errors

The request will list all applications monitored by the Instana agent that are throwing http 5xx errors. The **metric** attribute in the request object can be changed to http.4xx or http.3xx as needed.

Request:

```json
 curl -k -X POST  -H "Accept: application/json" -H "Content-Type: application/json" -H "Authorization: apiToken $API_TOKEN" \
  "https://$HOST/api/application-monitoring/metrics/applications?pretty" \
  -d '
{
  "applicationBoundaryScope": "ALL",
  "label": "Robot-Shop",
  "metrics": [
    {
      "aggregation": "SUM",
      "granularity": 0,
      "metric": "http.5xx"
    }
  ]
}'
```

Response:

```json
{
  "items" : [ {
    "application" : {
      "id" : "_8O83anZQW-72LB-HtBECg",
      "label" : "All Services",
      "boundaryScope" : "ALL",
      "entityType" : "APPLICATION"
    },
    "metrics" : {
      "http.5xx.sum" : [ [ 1692671360000, 13822.0 ] ]
    }
  }, {
    "application" : {
      "id" : "USD9KEU_SWaBbvj6AxubSA",
      "label" : "qotd",
      "boundaryScope" : "ALL",
      "entityType" : "APPLICATION"
    },
    "metrics" : {
      "http.5xx.sum" : [ [ 1692671360000, 0.0 ] ]
    }
  },{
    "application" : {
      "id" : "hov5KXevQMW8cM5wnGqgZw",
      "label" : "Robot-Shop",
      "boundaryScope" : "ALL",
      "entityType" : "APPLICATION"
    },
    "metrics" : {
      "http.5xx.sum" : [ [ 1692671360000, 13822.0 ] ]
    }
  } ],
  "page" : 1,
  "pageSize" : 20,
  "totalHits" : 7,
  "adjustedTimeframe" : {
    "windowSize" : 600000,
    "to" : 1692671360000
  }
}
```

### Query application services by application name

The request will list all applications monitored by the Instana agent that are throwing http 5xx errors. The nameFilter attribute in the request can be changed to the **qotd** applciaiton.

Request:

```json
curl -k --silent -X GET -H "authorization: apiToken $API_TOKEN"  "https://$HOST/api/application-monitoring/applications/services?pretty" -d 'nameFilter=Robot-Shop'
```

Response:

```json
{
  "items" : [ {
    "id" : "f9c1fe23e71948b618b228e526fb27d761fa7f66",
    "label" : "zookeeper",
    "types" : [ ],
    "technologies" : [ "jvmRuntimePlatform", "zooKeeper" ],
    "snapshotIds" : [ ],
    "entityType" : "SERVICE",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=f9c1fe23e71948b618b228e526fb27d761fa7f66?to=1692708030444&windowSize=600000",
      "endpoints" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=f9c1fe23e71948b618b228e526fb27d761fa7f66/endpoints?to=1692708030444&windowSize=600000"
    }
  }, {
    "id" : "4e014220bc3eebb5e5bcdc244c73a0109296562a",
    "label" : "yl-public.skillsnetwork.site",
    "types" : [ "HTTP" ],
    "technologies" : [ ],
    "snapshotIds" : [ ],
    "entityType" : "SERVICE",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=4e014220bc3eebb5e5bcdc244c73a0109296562a?to=1692708030444&windowSize=600000",
      "endpoints" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=4e014220bc3eebb5e5bcdc244c73a0109296562a/endpoints?to=1692708030444&windowSize=600000"
    }
  }, {
    "id" : "f0fcaa6767a729a923460a0fee7e2710fbd27ba8",
    "label" : "yl-public-redisha.yl-public.svc.cluster.local:26379",
    "types" : [ "DATABASE" ],
    "technologies" : [ "redis" ],
    "snapshotIds" : [ ],
    "entityType" : "SERVICE",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=f0fcaa6767a729a923460a0fee7e2710fbd27ba8?to=1692708030444&windowSize=600000",
      "endpoints" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=f0fcaa6767a729a923460a0fee7e2710fbd27ba8/endpoints?to=1692708030444&windowSize=600000"
    }
  }, {
    "id" : "1b5e8ac09a7837f059a2624a820f7da18c9de6a3",
    "label" : "yl-public-proxysql.yl-public.svc.cluster.local",
    "types" : [ "DATABASE" ],
    "technologies" : [ "mySqlDatabase" ],
    "snapshotIds" : [ ],
    "entityType" : "SERVICE",
    "_links" : {
      "self" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=1b5e8ac09a7837f059a2624a820f7da18c9de6a3?to=1692708030444&windowSize=600000",
      "endpoints" : "https://aiops.apps.ocp.ibm.edu/api/application-monitoring/applications/services;id=1b5e8ac09a7837f059a2624a820f7da18c9de6a3/endpoints?to=1692708030444&windowSize=600000"
    }
  }
  ```

## 4.3: Event Management 

### List of open Events

### List of open Events in the last 10 minutes



## 4.4: User Management 

### Get list or users

### Invite a user

### Remove a user

---
